# name: test/sql/aggregate/aggregates/test_arg_min_max.test
# description: Test argmin and argmax operator
# group: [aggregates]

statement ok
PRAGMA enable_verification

statement ok
PRAGMA verify_external

#Corner cases
statement error
select argmin()
----
Binder Error: No function matches the given name and argument types 'argmin()'. You might need to add explicit type casts.
	Candidate functions:
	argmin(INTEGER, INTEGER) -> INTEGER
	argmin(INTEGER, BIGINT) -> INTEGER
	argmin(INTEGER, DOUBLE) -> INTEGER
	argmin(INTEGER, VARCHAR) -> INTEGER
	argmin(INTEGER, DATE) -> INTEGER
	argmin(INTEGER, TIMESTAMP) -> INTEGER
	argmin(INTEGER, TIMESTAMP WITH TIME ZONE) -> INTEGER
	argmin(INTEGER, BLOB) -> INTEGER
	argmin(BIGINT, INTEGER) -> BIGINT
	argmin(BIGINT, BIGINT) -> BIGINT
	argmin(BIGINT, DOUBLE) -> BIGINT
	argmin(BIGINT, VARCHAR) -> BIGINT
	argmin(BIGINT, DATE) -> BIGINT
	argmin(BIGINT, TIMESTAMP) -> BIGINT
	argmin(BIGINT, TIMESTAMP WITH TIME ZONE) -> BIGINT
	argmin(BIGINT, BLOB) -> BIGINT
	argmin(DOUBLE, INTEGER) -> DOUBLE
	argmin(DOUBLE, BIGINT) -> DOUBLE
	argmin(DOUBLE, DOUBLE) -> DOUBLE
	argmin(DOUBLE, VARCHAR) -> DOUBLE
	argmin(DOUBLE, DATE) -> DOUBLE
	argmin(DOUBLE, TIMESTAMP) -> DOUBLE
	argmin(DOUBLE, TIMESTAMP WITH TIME ZONE) -> DOUBLE
	argmin(DOUBLE, BLOB) -> DOUBLE
	argmin(VARCHAR, INTEGER) -> VARCHAR
	argmin(VARCHAR, BIGINT) -> VARCHAR
	argmin(VARCHAR, DOUBLE) -> VARCHAR
	argmin(VARCHAR, VARCHAR) -> VARCHAR
	argmin(VARCHAR, DATE) -> VARCHAR
	argmin(VARCHAR, TIMESTAMP) -> VARCHAR
	argmin(VARCHAR, TIMESTAMP WITH TIME ZONE) -> VARCHAR
	argmin(VARCHAR, BLOB) -> VARCHAR
	argmin(DATE, INTEGER) -> DATE
	argmin(DATE, BIGINT) -> DATE
	argmin(DATE, DOUBLE) -> DATE
	argmin(DATE, VARCHAR) -> DATE
	argmin(DATE, DATE) -> DATE
	argmin(DATE, TIMESTAMP) -> DATE
	argmin(DATE, TIMESTAMP WITH TIME ZONE) -> DATE
	argmin(DATE, BLOB) -> DATE
	argmin(TIMESTAMP, INTEGER) -> TIMESTAMP
	argmin(TIMESTAMP, BIGINT) -> TIMESTAMP
	argmin(TIMESTAMP, DOUBLE) -> TIMESTAMP
	argmin(TIMESTAMP, VARCHAR) -> TIMESTAMP
	argmin(TIMESTAMP, DATE) -> TIMESTAMP
	argmin(TIMESTAMP, TIMESTAMP) -> TIMESTAMP
	argmin(TIMESTAMP, TIMESTAMP WITH TIME ZONE) -> TIMESTAMP
	argmin(TIMESTAMP, BLOB) -> TIMESTAMP
	argmin(TIMESTAMP WITH TIME ZONE, INTEGER) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, BIGINT) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, DOUBLE) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, VARCHAR) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, DATE) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, TIMESTAMP) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, TIMESTAMP WITH TIME ZONE) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, BLOB) -> TIMESTAMP WITH TIME ZONE
	argmin(BLOB, INTEGER) -> BLOB
	argmin(BLOB, BIGINT) -> BLOB
	argmin(BLOB, DOUBLE) -> BLOB
	argmin(BLOB, VARCHAR) -> BLOB
	argmin(BLOB, DATE) -> BLOB
	argmin(BLOB, TIMESTAMP) -> BLOB
	argmin(BLOB, TIMESTAMP WITH TIME ZONE) -> BLOB
	argmin(BLOB, BLOB) -> BLOB
	argmin(ANY, INTEGER) -> ANY
	argmin(ANY, BIGINT) -> ANY
	argmin(ANY, DOUBLE) -> ANY
	argmin(ANY, VARCHAR) -> ANY
	argmin(ANY, DATE) -> ANY
	argmin(ANY, TIMESTAMP) -> ANY
	argmin(ANY, TIMESTAMP WITH TIME ZONE) -> ANY
	argmin(ANY, BLOB) -> ANY

query I
select argmin(NULL,NULL)
----
NULL

query I
select argmin(1,1)
----
1

statement error
select argmin(*)
----
Binder Error: No function matches the given name and argument types 'argmin()'. You might need to add explicit type casts.
	Candidate functions:
	argmin(INTEGER, INTEGER) -> INTEGER
	argmin(INTEGER, BIGINT) -> INTEGER
	argmin(INTEGER, DOUBLE) -> INTEGER
	argmin(INTEGER, VARCHAR) -> INTEGER
	argmin(INTEGER, DATE) -> INTEGER
	argmin(INTEGER, TIMESTAMP) -> INTEGER
	argmin(INTEGER, TIMESTAMP WITH TIME ZONE) -> INTEGER
	argmin(INTEGER, BLOB) -> INTEGER
	argmin(BIGINT, INTEGER) -> BIGINT
	argmin(BIGINT, BIGINT) -> BIGINT
	argmin(BIGINT, DOUBLE) -> BIGINT
	argmin(BIGINT, VARCHAR) -> BIGINT
	argmin(BIGINT, DATE) -> BIGINT
	argmin(BIGINT, TIMESTAMP) -> BIGINT
	argmin(BIGINT, TIMESTAMP WITH TIME ZONE) -> BIGINT
	argmin(BIGINT, BLOB) -> BIGINT
	argmin(DOUBLE, INTEGER) -> DOUBLE
	argmin(DOUBLE, BIGINT) -> DOUBLE
	argmin(DOUBLE, DOUBLE) -> DOUBLE
	argmin(DOUBLE, VARCHAR) -> DOUBLE
	argmin(DOUBLE, DATE) -> DOUBLE
	argmin(DOUBLE, TIMESTAMP) -> DOUBLE
	argmin(DOUBLE, TIMESTAMP WITH TIME ZONE) -> DOUBLE
	argmin(DOUBLE, BLOB) -> DOUBLE
	argmin(VARCHAR, INTEGER) -> VARCHAR
	argmin(VARCHAR, BIGINT) -> VARCHAR
	argmin(VARCHAR, DOUBLE) -> VARCHAR
	argmin(VARCHAR, VARCHAR) -> VARCHAR
	argmin(VARCHAR, DATE) -> VARCHAR
	argmin(VARCHAR, TIMESTAMP) -> VARCHAR
	argmin(VARCHAR, TIMESTAMP WITH TIME ZONE) -> VARCHAR
	argmin(VARCHAR, BLOB) -> VARCHAR
	argmin(DATE, INTEGER) -> DATE
	argmin(DATE, BIGINT) -> DATE
	argmin(DATE, DOUBLE) -> DATE
	argmin(DATE, VARCHAR) -> DATE
	argmin(DATE, DATE) -> DATE
	argmin(DATE, TIMESTAMP) -> DATE
	argmin(DATE, TIMESTAMP WITH TIME ZONE) -> DATE
	argmin(DATE, BLOB) -> DATE
	argmin(TIMESTAMP, INTEGER) -> TIMESTAMP
	argmin(TIMESTAMP, BIGINT) -> TIMESTAMP
	argmin(TIMESTAMP, DOUBLE) -> TIMESTAMP
	argmin(TIMESTAMP, VARCHAR) -> TIMESTAMP
	argmin(TIMESTAMP, DATE) -> TIMESTAMP
	argmin(TIMESTAMP, TIMESTAMP) -> TIMESTAMP
	argmin(TIMESTAMP, TIMESTAMP WITH TIME ZONE) -> TIMESTAMP
	argmin(TIMESTAMP, BLOB) -> TIMESTAMP
	argmin(TIMESTAMP WITH TIME ZONE, INTEGER) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, BIGINT) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, DOUBLE) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, VARCHAR) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, DATE) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, TIMESTAMP) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, TIMESTAMP WITH TIME ZONE) -> TIMESTAMP WITH TIME ZONE
	argmin(TIMESTAMP WITH TIME ZONE, BLOB) -> TIMESTAMP WITH TIME ZONE
	argmin(BLOB, INTEGER) -> BLOB
	argmin(BLOB, BIGINT) -> BLOB
	argmin(BLOB, DOUBLE) -> BLOB
	argmin(BLOB, VARCHAR) -> BLOB
	argmin(BLOB, DATE) -> BLOB
	argmin(BLOB, TIMESTAMP) -> BLOB
	argmin(BLOB, TIMESTAMP WITH TIME ZONE) -> BLOB
	argmin(BLOB, BLOB) -> BLOB
	argmin(ANY, INTEGER) -> ANY
	argmin(ANY, BIGINT) -> ANY
	argmin(ANY, DOUBLE) -> ANY
	argmin(ANY, VARCHAR) -> ANY
	argmin(ANY, DATE) -> ANY
	argmin(ANY, TIMESTAMP) -> ANY
	argmin(ANY, TIMESTAMP WITH TIME ZONE) -> ANY
	argmin(ANY, BLOB) -> ANY

query I
select argmin(i,i) from range (100) tbl(i);
----
0

query I
select argmin(i,i) from range (100) tbl(i) where 1 = 0;
----
NULL

statement error
select argmax()
----
PLACEHOLDER_ERROR_MESSAGE1553

query I
select argmax(NULL,NULL)
----
NULL

query I
select argmax(1,1)
----
1

statement error
select argmax(*)
----
PLACEHOLDER_ERROR_MESSAGE1552

query I
select argmax(i,i) from range (100) tbl(i);
----
99

query I
select argmax(i,i) from range (100) tbl(i) where 1 = 0;
----
NULL

statement ok
create table args (a integer, b integer)

statement ok
insert into args values (1,1), (2,2), (8,8), (10,10)

query II
select argmin(a,b), argmax(a,b) from args;
----
1.000000	10.000000

query II
select argmin(a,b), argmax(a,b) from args group by a%2 ORDER BY argmin(a,b);
----
1	1
2	10

statement ok
CREATE TABLE blobs (b BYTEA, a BIGINT);

statement ok
INSERT INTO blobs VALUES('\xaa\xff\xaa',5), ('\xAA\xFF\xAA\xAA\xFF\xAA',30), ('\xAA\xFF\xAA\xAA\xFF\xAA\xAA\xFF\xAA',20)

query II
select argmin(b,a), argmax(b,a)  from blobs ;
----
\xAA\xFF\xAA	\xAA\xFF\xAA\xAA\xFF\xAA

query II
select argmin(a,b), argmax(a,b)  from blobs ;
----
5	20

# Window Function
query I rowsort
select argmin(a,b) over ( partition by a%2) from args;
----
1
2
2
2

query I rowsort
select argmax(a,b) over ( partition by a%2) from args;
----
1
10
10
10

statement ok
create table names (name string, salary integer)

statement ok
insert into names values ('Pedro',10), ('Hannes',20), ('Mark',15), ('Hubert-Blaine-Wolfeschlegelsteinhausenbergerdorff',30)

query II
select argmin(name,salary),argmax(name,salary)  from names;
----
Pedro	Hubert-Blaine-Wolfeschlegelsteinhausenbergerdorff

query II
select argmin(salary,name),argmax(salary,name)  from names;
----
20	10

# test min_by max_by alias
query II
select min_by(name,salary),max_by(name,salary)  from names;
----
Pedro	Hubert-Blaine-Wolfeschlegelsteinhausenbergerdorff

# test arg_min arg_max alias
query II
select arg_min(name,salary),arg_max(name,salary)  from names;
----
Pedro	Hubert-Blaine-Wolfeschlegelsteinhausenbergerdorff
