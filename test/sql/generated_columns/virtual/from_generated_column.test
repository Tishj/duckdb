# name: test/sql/generated_columns/virtual/from_generated_column.test
# description: Expected behavior when trying to create a generated column from a generated column
# group: [virtual]

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE unit (price INTEGER, amount_sold INTEGER);

statement ok
INSERT INTO unit VALUES (5,4)

# ALTER TABLE - ADD COLUMN generated column not supported yet
statement error
ALTER TABLE unit ADD COLUMN total_profit INTEGER GENERATED ALWAYS AS (price * amount_sold) VIRTUAL;
----
Parser Error: Adding generated columns after table creation is not supported yet

statement error
SELECT total_profit FROM unit
----
Binder Error: Referenced column "total_profit" not found in FROM clause!
Candidate bindings: "unit.price"

statement error
ALTER TABLE unit ADD COLUMN also_total_profit INTEGER GENERATED ALWAYS AS (total_profit) VIRTUAL;
----
Parser Error: Adding generated columns after table creation is not supported yet

statement error
SELECT also_total_profit FROM unit
----
PLACEHOLDER_ERROR_MESSAGE1145

# Create a table with a generated column, and another generated column created from this other one
statement ok
CREATE TABLE unit2(
	price INTEGER,
	amount_sold INTEGER,
	total_profit INTEGER GENERATED ALWAYS AS (price * amount_sold) VIRTUAL,
	also_total_profit INTEGER GENERATED ALWAYS AS (total_profit) VIRTUAL
);

statement ok
INSERT INTO unit2 VALUES (100, 0)

query IIII
SELECT * FROM unit2
----
100	0	0	0
