# name: test/sql/types/hugeint/hugeint_multiply.test
# description: Test correct computation of hugeint multiplication
# group: [hugeint]

# overflows of various parts of the multiplication
# hugeint multiplication is done in 4 segments (low bits & high bits of the lower and upper int64 part)
# we test all combinations here
# 251658240           =                  [low, low]
# 1080863910568919040 =                  [low, high]
# 4642275147320176030871715840           [high, low]
# 19938419936773738093557105904205168640 [high, high]

# [low, low] mult
query I
SELECT 251658240::HUGEINT * 251658240::HUGEINT
----
63331869759897600

query I
SELECT 251658240::HUGEINT * 1080863910568919040::HUGEINT
----
272008309413291564308889600

query I
SELECT 251658240::HUGEINT * 4642275147320176030871715840::HUGEINT
----
1168266793170336216419361674074521600

statement error
SELECT 251658240::HUGEINT * 19938419936773738093557105904205168640::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (251658240 * 19938419936773738093557105904205168640)!

# [low, high]
query I
SELECT 1080863910568919040::HUGEINT * 251658240::HUGEINT
----
272008309413291564308889600

query I
SELECT 1080863910568919040::HUGEINT * 1080863910568919040::HUGEINT
----
1168266793170336216419361674074521600

statement error
SELECT 1080863910568919040::HUGEINT * 4642275147320176030871715840::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (1080863910568919040 * 4642275147320176030871715840)!

statement error
SELECT 1080863910568919040::HUGEINT * 19938419936773738093557105904205168640::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (1080863910568919040 * 19938419936773738093557105904205168640)!

# [high, low]
query I
SELECT 4642275147320176030871715840::HUGEINT * 251658240::HUGEINT
----
1168266793170336216419361674074521600

statement error
SELECT 4642275147320176030871715840::HUGEINT * 1080863910568919040::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (4642275147320176030871715840 * 1080863910568919040)!

statement error
SELECT 4642275147320176030871715840::HUGEINT * 4642275147320176030871715840::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (4642275147320176030871715840 * 4642275147320176030871715840)!

statement error
SELECT 4642275147320176030871715840::HUGEINT * 19938419936773738093557105904205168640::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (4642275147320176030871715840 * 19938419936773738093557105904205168640)!

# [high, high]
statement error
SELECT 19938419936773738093557105904205168640::HUGEINT * 251658240::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (19938419936773738093557105904205168640 * 251658240)!

statement error
SELECT 19938419936773738093557105904205168640::HUGEINT * 1080863910568919040::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (19938419936773738093557105904205168640 * 1080863910568919040)!

statement error
SELECT 19938419936773738093557105904205168640::HUGEINT * 4642275147320176030871715840::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (19938419936773738093557105904205168640 * 4642275147320176030871715840)!

statement error
SELECT 19938419936773738093557105904205168640::HUGEINT * 19938419936773738093557105904205168640::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (19938419936773738093557105904205168640 * 19938419936773738093557105904205168640)!

# more overflow tests on the boundaries
query I
SELECT 85070591730234615865843651857942052863::HUGEINT * 2::HUGEINT
----
170141183460469231731687303715884105726

statement error
SELECT 85070591730234615865843651857942052864::HUGEINT * 2::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (85070591730234615865843651857942052864 * 2)!

statement error
SELECT 85070591730234615865843651857942052865::HUGEINT * 2::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (85070591730234615865843651857942052865 * 2)!

query I
SELECT 19807040628566084398385987583::HUGEINT * 8589934592::HUGEINT
----
170141183460469231731687303707294171136

statement error
SELECT 19807040628566084398385987584::HUGEINT*8589934592::HUGEINT;
----
Out of Range Error: Overflow in multiplication of INT128 (19807040628566084398385987584 * 8589934592)!

query I
SELECT 36893488147419103231::HUGEINT * 4611686018427387904::HUGEINT
----
170141183460469231727075617697456717824

statement error
SELECT 36893488147419103232::HUGEINT * 4611686018427387904::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (36893488147419103232 * 4611686018427387904)!

# now reverse sides
query I
SELECT 2::HUGEINT * 85070591730234615865843651857942052863::HUGEINT
----
170141183460469231731687303715884105726

statement error
SELECT 2::HUGEINT * 85070591730234615865843651857942052864::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (2 * 85070591730234615865843651857942052864)!

statement error
SELECT 2::HUGEINT * 85070591730234615865843651857942052865::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (2 * 85070591730234615865843651857942052865)!

query I
SELECT 8589934592::HUGEINT * 19807040628566084398385987583::HUGEINT
----
170141183460469231731687303707294171136

statement error
SELECT 8589934592::HUGEINT * 19807040628566084398385987584::HUGEINT
----
PLACEHOLDER_ERROR_MESSAGE1073

query I
SELECT 4611686018427387904::HUGEINT * 36893488147419103231::HUGEINT
----
170141183460469231727075617697456717824

statement error
SELECT 4611686018427387904::HUGEINT * 36893488147419103232::HUGEINT
----
PLACEHOLDER_ERROR_MESSAGE1072

query I
SELECT 10376293541461622783::HUGEINT * 10376293541461622783::HUGEINT
----
107667467658578185684455784799784665089

query I
SELECT 10376293541461622783::HUGEINT * 10376293541461622783::HUGEINT
----
107667467658578185684455784799784665089

statement error
SELECT 17293822569102704639::HUGEINT * 10376293541461622783::HUGEINT
----
PLACEHOLDER_ERROR_MESSAGE1071
