# name: test/sql/types/decimal/decimal_overflow.test
# description: Test overflow in various decimal computations
# group: [decimal]

statement ok
PRAGMA enable_verification

# decimals can also overflow at the bigint boundary, because we don't perform automatic upcasting to hugeint
statement error
select (99000000000000000.0::DECIMAL(18,1)+99000000000000000.0::DECIMAL(18,1));
----
Out of Range Error: Overflow in addition of DECIMAL(18) (990000000000000000 + 990000000000000000). You might want to add an explicit cast to a bigger decimal.

statement error
select (99000000000000000.0::DECIMAL(18,1)+99000000000000000.0::DECIMAL(18,1))::VARCHAR::DECIMAL(18,1);
----
Out of Range Error: Overflow in addition of DECIMAL(18) (990000000000000000 + 990000000000000000). You might want to add an explicit cast to a bigger decimal.

statement error
select (50000000000000000.0::DECIMAL(18,1)+50000000000000000.0::DECIMAL(18,1));
----
Out of Range Error: Overflow in addition of DECIMAL(18) (500000000000000000 + 500000000000000000). You might want to add an explicit cast to a bigger decimal.

statement error
select (-99000000000000000.0::DECIMAL(18,1)-99000000000000000.0::DECIMAL(18,1));
----
Out of Range Error: Overflow in subtract of DECIMAL(18) (-990000000000000000 - 990000000000000000). You might want to add an explicit cast to a bigger decimal.

statement error
select (-50000000000000000.0::DECIMAL(18,1)-50000000000000000.0::DECIMAL(18,1));
----
PLACEHOLDER_ERROR_MESSAGE374

# decimals can overflow at the hugeint boundary, because we run out of bits
statement error
select (9900000000000000000000000000000000000.0::DECIMAL(38,1)+9900000000000000000000000000000000000.0::DECIMAL(38,1));
----
PLACEHOLDER_ERROR_MESSAGE373

statement error
select (5000000000000000000000000000000000000.0::DECIMAL(38,1)+5000000000000000000000000000000000000.0::DECIMAL(38,1));
----
PLACEHOLDER_ERROR_MESSAGE372

statement error
select '10000000000000000000000000000000000000.0'::DECIMAL(38,1);
----
PLACEHOLDER_ERROR_MESSAGE371

statement error
select (-5000000000000000000000000000000000000.0::DECIMAL(38,1)-5000000000000000000000000000000000000.0::DECIMAL(38,1));
----
PLACEHOLDER_ERROR_MESSAGE370

# decimals can overflow in multiplications
# bigint
statement error
select 90000000000000000.0::DECIMAL(18,1) * 10::DECIMAL(2,0);
----
PLACEHOLDER_ERROR_MESSAGE369

statement error
select 90000000000000000.0::DECIMAL(18,1) * 1000::DECIMAL(4,0);
----
PLACEHOLDER_ERROR_MESSAGE368

# hugeint
statement error
select 5000000000000000000000000000000000000.0::DECIMAL(38,1) * 2::DECIMAL(1,0);
----
PLACEHOLDER_ERROR_MESSAGE367

# but also like this... the type of this multiplication becomes DECIMAL(38,2), which does not fit 9900000000000000000000000000000000000
statement error
select 9900000000000000000000000000000000000.0::DECIMAL(38,1) * 1.0;
----
PLACEHOLDER_ERROR_MESSAGE366
