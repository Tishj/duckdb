# name: test/sql/copy/s3/query_param_contains_dot.test
# description: Test S3, credentials override with query parameters
# group: [s3]

require parquet

require httpfs

#require-env S3_TEST_SERVER_AVAILABLE 1

## Require that these environment variables are also set

#require-env AWS_DEFAULT_REGION

#require-env AWS_ACCESS_KEY_ID

#require-env AWS_SECRET_ACCESS_KEY

#require-env DUCKDB_S3_ENDPOINT

#require-env DUCKDB_S3_USE_SSL

## override the default behaviour of skipping HTTP errors and connection failures: this test fails on connection issues
#set ignore_error_messages

query I
select query_param('s3://test-bucket/s3_query_params/test.parquet?s3_url_style=vhost', 's3_url_style');
----
vhost

# Query parameter value contains '.'
query I
select query_param('s3://test-bucket/data_0.parquet?partNumber=1&uploadId=1_X6JmBpcba6CpYIKsbeO9XbOK.eRfTJzXhMyx2OZKSQUJ.w2eFADSc8fyQec77c1tJK6bp381ESX__5lfAccVsUS.ovfQY0JzltvvsbFD.c5CBnP9zVr9xmhi.8pgOFMTYwOD6tDrpOBsK7WAsDKFTfW8rvMEZeIECWYc6wXXu._QutdzKs6AOEB.XAibGJ', 'uploadId');
----
1_X6JmBpcba6CpYIKsbeO9XbOK.eRfTJzXhMyx2OZKSQUJ.w2eFADSc8fyQec77c1tJK6bp381ESX__5lfAccVsUS.ovfQY0JzltvvsbFD.c5CBnP9zVr9xmhi.8pgOFMTYwOD6tDrpOBsK7WAsDKFTfW8rvMEZeIECWYc6wXXu._QutdzKs6AOEB.XAibGJ
