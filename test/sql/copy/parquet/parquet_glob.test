# name: test/sql/copy/parquet/parquet_glob.test
# description: Test basic globbing of parquet files
# group: [parquet]

require parquet

statement ok
PRAGMA enable_verification

query II
select * from parquet_scan('data/parquet-testing/glob*/t?.parquet') order by i
----
1	a
2	b
3	c

query II
select * from parquet_scan('data/parquet-testing/glob/t[0-9].parquet') order by i
----
1	a
2	b

query II
select * from parquet_scan('data/parquet-testing/glob/*') order by i
----
1	a
2	b

query II
select * from parquet_scan('data/parquet-testing/glob/*.parquet') order by i
----
1	a
2	b

query II
select * from parquet_scan('data/parquet-testing/g*/*.parquet') order by i
----
1	a
2	b
3	c

query II
select * from parquet_scan('data/parquet-testing/g*/t1.parquet') order by i
----
1	a
3	c

# abs path
query II
select * from parquet_scan('__WORKING_DIRECTORY__/data/parquet-testing/g*/t1.parquet') order by i
----
1	a
3	c

# forward slashes
query II
select * from parquet_scan('data\parquet-testing\g*\t1.parquet') order by i
----
1	a
3	c

# Double partial matches
query II rowsort
FROM parquet_scan('data/parquet-testing/glob3/*/dir/*.parquet');
----
1	a
3	c

statement error
select count(*) from parquet_scan('')
----
IO Error: No files found that match the pattern ""

# schema mismatch in parquet glob
statement error
select * from parquet_scan('data/parquet-testing/*.parquet')
----
IO Error: Failed to read file "data/parquet-testing/bug1618_struct_strings.parquet": schema mismatch in glob: column "FRUIT" was read from the original file "data/parquet-testing/delta_length_byte_array.parquet", but could not be found in file "data/parquet-testing/bug1618_struct_strings.parquet".
Candidate names: inner
If you are trying to read files with different schemas, try setting union_by_name=True

# parquet glob with COPY FROM
statement ok
CREATE TABLE vals (i INTEGER, j BLOB)

statement ok
COPY vals FROM 'data/parquet-testing/glob/t?.parquet' (FORMAT PARQUET);

query II
SELECT * FROM vals ORDER BY 1
----
1	a
2	b

# failed to copy: incorrect types found in parquet file
statement ok
CREATE TABLE vals2 (i INTEGER, j INTEGER)

statement error
COPY vals2 FROM '*/sql/*/parquet/*/glob/t?.parquet' (FORMAT PARQUET);
----
IO Error: No files found that match the pattern "*/sql/*/parquet/*/glob/t?.parquet"
